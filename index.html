<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kim's Bible Study</title>
    <style>
        /* 기본 스타일 초기화 */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f4f4f9;
            overflow: hidden; /* 스크롤바 숨김 */
        }

        /* 로그인 컨테이너 */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .login-box {
            padding: 40px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 320px;
        }
        .login-box h1 {
            margin-bottom: 20px;
            font-size: 24px;
            color: #333;
        }
        .login-box input {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .login-box button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .login-box button:hover {
            background-color: #0056b3;
        }
        #login-error {
            color: red;
            font-size: 14px;
            margin-top: 10px;
            height: 20px;
        }

        /* 메인 앱 컨테이너 */
        #app-container {
            display: none; /* 초기에는 숨김 */
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 헤더 */
        header {
            background-color: #333;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        header h1 {
            margin: 0;
            font-size: 22px;
        }
        #logout-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #logout-button:hover {
            background-color: #c82333;
        }

        /* 메인 컨텐츠 영역 */
        .main-content {
            display: flex;
            flex-grow: 1;
            height: calc(100vh - 60px); /* 헤더 높이 제외 */
        }

        /* 좌측 네비게이션 */
        nav {
            width: 200px;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding: 15px;
            overflow-y: auto;
        }
        nav h2 {
            margin-top: 0;
            font-size: 18px;
            color: #333;
        }
        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        nav li {
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 5px;
            transition: background-color 0.2s, color 0.2s;
        }
        nav li:hover {
            background-color: #e9ecef;
        }
        nav li.active {
            background-color: #007bff;
            color: white;
        }

        /* 우측 컨텐츠 영역 */
        main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* 탭 바 */
        .tab-bar {
            display: flex;
            background-color: #e9ecef;
            padding: 5px 5px 0 5px;
            border-bottom: 1px solid #ccc;
            flex-shrink: 0;
        }
        .tab {
            padding: 10px 15px;
            background-color: #f1f1f1;
            cursor: pointer;
            border: 1px solid #ccc;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            position: relative;
            display: flex;
            align-items: center;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
        }
        .tab .close-tab {
            margin-left: 10px;
            font-weight: bold;
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 50%;
        }
        .tab .close-tab:hover {
            background-color: #ddd;
        }

        /* 탭 컨텐츠 */
        .tab-content-area {
            flex-grow: 1;
            position: relative;
            background-color: white;
        }
        .tab-content {
            display: none;
            padding: 20px;
            height: 100%;
            overflow-y: auto;
            box-sizing: border-box;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>

    <!-- 로그인 화면 -->
    <div id="login-container">
        <div class="login-box">
            <h1>로그인</h1>
            <input type="text" id="username" placeholder="아이디">
            <input type="password" id="password" placeholder="비밀번호">
            <button id="login-button">로그인</button>
            <p id="login-error"></p>
        </div>
    </div>

    <!-- 메인 앱 화면 -->
    <div id="app-container" style="display: none;">
        <header>
            <h1>Kim's Bible Study page</h1>
            <button id="logout-button">로그인</button>
        </header>
        <div class="main-content">
            <nav id="side-nav">
                <h2>메뉴</h2>
                <ul id="menu-list">
                    <!-- 메뉴는 JS로 동적으로 생성됩니다 -->
                </ul>
            </nav>
            <main>
                <div class="tab-bar" id="tab-bar">
                    <!-- 탭은 JS로 동적으로 생성됩니다 -->
                </div>
                <div class="tab-content-area" id="tab-content-area">
                    <!-- 탭 내용은 JS로 동적으로 생성됩니다 -->
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- 1. 설정 (menu-config.js 역할) ---
        // 이제 pages 폴더에 있는 실제 파일 이름과 title을 매칭시킵니다.
        const menuConfig = [
            { file: 'genesis.html', title: '창세기' },
            { file: 'exodus.html', title: '출애굽기' },
            { file: 'leviticus.html', title: '레위기' },
        ];

        // --- 2. 주요 DOM 요소 가져오기 ---
        const loginContainer = document.getElementById('login-container');
        const appContainer = document.getElementById('app-container');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const menuList = document.getElementById('menu-list');
        const tabBar = document.getElementById('tab-bar');
        const tabContentArea = document.getElementById('tab-content-area');
        const loginError = document.getElementById('login-error');

        // --- 3. 로그인/로그아웃 기능 ---
        loginButton.addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username && password) {
                loginContainer.style.display = 'none';
                appContainer.style.display = 'flex';
                initApp();
            } else {
                loginError.textContent = '아이디와 비밀번호를 입력하세요.';
            }
        });

        logoutButton.addEventListener('click', () => {
            location.reload();
        });

        // --- 4. 앱 초기화 및 메뉴 생성 ---
        function initApp() {
            menuConfig.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.title;
                li.dataset.file = item.file; // data-id 대신 data-file 사용
                li.addEventListener('click', () => openTab(item.file, item.title));
                menuList.appendChild(li);
            });
        }

        // --- 5. 탭 기능 구현 (fetch 사용) ---
        async function openTab(file, title) {
            // 이미 탭이 열려있는지 확인
            if (document.querySelector(`.tab[data-file="${file}"]`)) {
                setActiveTab(file);
                return;
            }

            // 새로운 탭 생성
            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.dataset.file = file;
            tab.innerHTML = `
                <span>${title}</span>
                <span class="close-tab" data-file="${file}">&times;</span>
            `;
            tab.addEventListener('click', () => setActiveTab(file));
            tab.querySelector('.close-tab').addEventListener('click', (e) => {
                e.stopPropagation();
                closeTab(file);
            });
            tabBar.appendChild(tab);

            // 새로운 탭 컨텐츠 생성
            const content = document.createElement('div');
            content.className = 'tab-content';
            content.dataset.file = file;
            content.innerHTML = `<p>로딩 중...</p>`; // 로딩 표시
            tabContentArea.appendChild(content);
            
            // fetch를 사용해 pages 폴더에서 파일 내용 가져오기
            try {
                const response = await fetch(`pages/${file}`);
                if (!response.ok) { // 파일이 없거나 에러 발생 시
                    throw new Error('파일을 불러올 수 없습니다.');
                }
                const htmlContent = await response.text();
                content.innerHTML = htmlContent;
            } catch (error) {
                console.error('Fetch error:', error);
                content.innerHTML = `<h2>${title}</h2><p>내용을 불러오는 데 실패했습니다.</p>`;
            }

            setActiveTab(file);
        }

        function setActiveTab(file) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('#menu-list li').forEach(m => m.classList.remove('active'));

            const tab = document.querySelector(`.tab[data-file="${file}"]`);
            const content = document.querySelector(`.tab-content[data-file="${file}"]`);
            const menuItem = document.querySelector(`#menu-list li[data-file="${file}"]`);
            
            if(tab) tab.classList.add('active');
            if(content) content.classList.add('active');
            if(menuItem) menuItem.classList.add('active');
        }

        function closeTab(file) {
            const tab = document.querySelector(`.tab[data-file="${file}"]`);
            const content = document.querySelector(`.tab-content[data-file="${file}"]`);
            
            const wasActive = tab.classList.contains('active');
            
            tab.remove();
            content.remove();

            if (wasActive && tabBar.children.length > 0) {
                const lastTab = tabBar.children[tabBar.children.length - 1];
                setActiveTab(lastTab.dataset.file);
            } else if (tabBar.children.length === 0) {
                document.querySelectorAll('#menu-list li').forEach(m => m.classList.remove('active'));
            }
        }
    </script>
</body>
</html>
